const t=new class{constructor(t=this.getInitialState()){this.state=t,this.score=0,this.status="idle"}moveLeft(){this.moveInline("left")}moveRight(){this.moveInline("right")}moveUp(){this.moveBlock("up")}moveDown(){this.moveBlock("down")}getScore(){return this.score}getState(){return this.state}getStatus(){return this.status}start(){this.score=0,this.status="playing",this.addRandomSell(),this.addRandomSell()}restart(){this.status="idle",this.score=0,this.state=this.getInitialState()}moveBlock(t){if("playing"===this.getStatus()){let e=!1;this.state.forEach((s,i)=>{let a=[];s.forEach((t,e)=>{a.push(this.state[e][i])});let l=this.getNotEmptyCells(a,t);l=this.mergeCells(l,t);for(let t=0;t<4;t++)this.state[t][i]=l[t]||0,this.state[t][i]!==a[t]&&(e=!0)}),e&&(this.addRandomSell(),this.checkWinLose())}}moveInline(t){if("playing"===this.getStatus()){let e;this.state.forEach(s=>{let i=[...s],a=this.getNotEmptyCells(s,t);a=this.mergeCells(a,t),s.forEach((t,e)=>{s[e]=a[e]||0}),i.every((t,e)=>t===s[e])||(e=!0)}),e&&(this.addRandomSell(),this.checkWinLose())}}getInitialState(){return[,,,,].fill(0).map(()=>[,,,,].fill(0))}addRandomSell(){let t=[];for(let e=0;e<4;e++)for(let s=0;s<4;s++)0===this.state[e][s]&&t.push([e,s]);let e=Math.floor(Math.random()*t.length),s=.9>Math.random()?2:4,[i,a]=t[e];this.state[i][a]=s}getNotEmptyCells(t,e){let s=t.filter(t=>t>0);if("right"===e||"down"===e)for(;s.length<4;)s.unshift(0);if("left"===e||"up"===e)for(;s.length<4;)s.push(0);return s}mergeCells(t,e){for(let e=0;e<t.length-1;e++){let s=t[e],i=t[e+1];s===i&&s>0&&(this.score+=s+i,t[e]=s+i,t.splice(e+1,1))}return"right"===e||"down"===e?this.getNotEmptyCells(t,e):t}hasMove(){for(let t=0;t<4;t++)for(let e=0;e<4;e++){let s=this.state[t][e];if(0===s||(t<3?this.state[t+1][e]:0)===s||(e<3?this.state[t][e+1]:0)===s)return!0}return!1}checkWinLose(){this.state.some(t=>t.includes(2048))&&(this.status="win"),this.hasMove()||(this.status="lose")}},e=document.querySelector(".button.start"),s=document.querySelector(".message-start"),i=document.querySelector(".message-win"),a=document.querySelector(".message-lose"),l=document.querySelector(".game-score");function o(){let e=t.getState(),s=document.querySelectorAll(".field-row");l.textContent=t.getScore(),e.forEach((t,e)=>{t.forEach((t,i)=>{let a=s[e].children[i];a.className="field-cell",a.textContent="",t>0&&(a.textContent=t,a.classList.add(`field-cell--${t}`))})}),"win"===t.getStatus()?i.classList.remove("hidden"):"lose"===t.getStatus()&&a.classList.remove("hidden")}e.addEventListener("click",()=>{"idle"===t.getStatus()?(t.start(),e.classList.remove("start"),e.classList.add("restart"),e.textContent="Restart",s.classList.add("hidden")):(e.classList.remove("restart"),e.classList.add("start"),e.textContent="Start",s.classList.remove("hidden"),a.classList.add("hidden"),i.classList.add("hidden"),t.restart()),o()}),document.addEventListener("keydown",e=>{switch(e.key){case"ArrowLeft":t.moveLeft();break;case"ArrowRight":t.moveRight();break;case"ArrowUp":t.moveUp();break;case"ArrowDown":t.moveDown()}o()});
//# sourceMappingURL=index.e6ff1378.js.map
